# Chain Talk 开发执行路线

## 第一阶段：智能合约修改

### 步骤1：分析现有合约结构
- [x] 查看当前合约代码
- [x] 理解现有数据结构
- [x] 确定需要修改的部分

### 步骤2：设计新的合约结构
- [x] 设计Topic数据结构
- [x] 设计Reply数据结构
- [x] 规划ID管理机制

### 步骤3：修改合约代码
- [x] 添加Topic结构体
- [x] 添加Reply结构体
- [x] 实现createTopic函数
- [x] 实现createReply函数
- [x] 修改事件定义

### 步骤4：更新前端常量
- [x] 更新CONTRACT_ABI
- [x] 编译合约验证
- [ ] 测试合约交互

## 第二阶段：前端重构

### 步骤5：重构为单页展开式论坛
- [x] 移除原有日记相关代码
- [ ] 实现主题列表展示
- [ ] 添加发主题组件

### 步骤6：实现展开/收起功能
- [ ] 实现标题点击展开
- [ ] 实现主题内容展示
- [ ] 添加回复列表组件

### 步骤7：实现回复功能
- [ ] 添加回复表单组件
- [ ] 实现回复提交逻辑
- [ ] 实现回复展示

### 步骤8：重构数据流
- [ ] 修改数据获取逻辑
- [ ] 适配新的数据结构
- [ ] 实现主题和回复的关联展示

## 第三阶段：测试和优化

### 步骤9：功能测试
- [ ] 测试创建主题功能
- [ ] 测试回复功能
- [ ] 验证数据展示

### 步骤10：部署测试
- [ ] 部署到测试网
- [ ] 验证链上数据
- [ ] 优化用户体验

---

## 执行记录

### 当前状态：第二阶段开始
- 已完成：第一阶段所有任务，设计决策确定
- 新增：单页展开式设计决策
- 下一步：重构为单页展开式论坛
- 预计完成时间：今天

---

## 设计决策更新

### 单页展开式论坛
- **决策**：采用单页展开，而非多页跳转
- **理由**：极简体验，符合产品定位，实现简单
- **交互**：点击标题展开/收起主题内容和回复
- **优势**：流畅连续，无需路由，适合第一版原型

---

## 合约编译成功

### 编译结果
- ✅ 合约语法正确
- ✅ 支持createTopic和createReply
- ✅ 事件定义正确
- ✅ 准备进行前端重构

### 第一阶段总结
- 合约设计完成：极简的论坛功能
- 前端常量更新：支持新的合约接口
- 编译验证通过：代码无语法错误
- 设计决策确定：content第一行作为标题

---

## 设计决策更新

### 极简标题设计
- **决策**：content第一行作为标题，超过100字符则截断
- **实现**：前端解析content，按换行符分割
- **优势**：保持极简，同时提供基本的浏览体验

### 合约修改
- `createTopic(content)` - 创建主题（只需要内容）
- `createReply(topicId, content)` - 回复主题
- 移除了title参数，简化用户输入

### 前端常量更新
- 更新了CONTRACT_ABI
- 移除title相关字段
- 准备实现标题解析逻辑

---

## 合约设计分析

### 现有合约结构
- 单一函数：`writeEntry(string content)`
- 单一事件：`EntryCreated(address user, uint256 timestamp, string content)`
- 极简设计，无状态存储

### 新合约设计
- 需要添加状态存储来管理主题ID
- 需要分离主题和回复的事件
- 需要ID自增机制

### 数据结构设计
```
Topic: {id, title, content, author, timestamp}
Reply: {id, topicId, content, author, timestamp}
```

---

## 技术备注
- 保持极简设计风格
- 复用现有UI组件
- 确保TypeScript类型安全
- 优化gas使用效率